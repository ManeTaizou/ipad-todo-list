<!DOCTYPE html>

<html lang="ja">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>ToDoリスト</title>

  <style>

    :root {

      --bg: #f7f7fb;

      --card: #ffffff;

      --ink: #1f2937;

      --muted: #6b7280;

      --accent: #2563eb;

      --border: #e5e7eb;

      --checked: #9ca3af;

      --radius: 12px;

    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {

      margin: 0;

      background: var(--bg);

      color: var(--ink);

      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;

      line-height: 1.4;

      font-size: 14px;

    }

    header {

      background: var(--card);

      border-bottom: 1px solid var(--border);

      padding: 4px 8px;

      position: sticky;

      top: 0;

      z-index: 10;

    }

    h1 { font-size: 20px; }

    .controls button { margin: 0 4px; padding: 4px 8px; font-size: 12px; }



    main { padding: 8px; }

    .cards { display: grid; gap: 8px; grid-template-columns: repeat(12, 1fr); }



    .card, .weekday {

      background: var(--card);

      border: 1px solid var(--border);

      border-radius: var(--radius);

      padding: 6px;

    }

    .card h2, .weekday h3 { font-size: 14px; margin-bottom: 4px; color: var(--muted); }



    #month { grid-column: span 6; }

    #week { grid-column: span 6; }

    .week-grid { display: grid; gap: 8px; grid-template-columns: repeat(7, 1fr); grid-column: 1/-1; }



    .item { display: flex; align-items: center; gap: 4px; margin-bottom: 2px; }

    .item input[type="checkbox"] { width: 14px; height: 14px; }

    .item input.text {

      flex: 1;

      border: none;

      background: transparent;

      padding: 2px 4px;

      font-size: 13px;

    }

    .item.checked input.text { text-decoration: line-through; color: var(--checked); }



    @media (max-width: 1180px) {

      #month, #week { grid-column: span 12; }

      .week-grid { grid-template-columns: repeat(7, minmax(160px, 1fr)); overflow-x: auto; }

      .weekday { min-width: 180px; }

    }

  </style>

</head>

<body>

  <header>

    <h1>ToDoリスト</h1>

    <div class="controls">

      <button id="clearChecks">全チェック解除</button>

      <button id="resetAll">すべてリセット</button>

      <button id="exportData">バックアップ書き出し</button>

      <label for="importDataInput">読み込み<input id="importDataInput" type="file" accept="application/json" style="display:none"></label>

    </div>

  </header>



  <main>

    <section class="cards">

      <div class="card" id="month">

        <h2>今月やること</h2>

        <div class="list" data-section="month" data-rows="10"></div>

      </div>

      <div class="card" id="week">

        <h2>今週やること</h2>

        <div class="list" data-section="week" data-rows="5"></div>

      </div>

      <div class="week-grid" id="weekdays"></div>

    </section>

  </main>



  <script>

    const STORAGE_KEY = 'ipad-todo';

    const days = ["月曜日","火曜日","水曜日","木曜日","金曜日","土曜日","日曜日"];

    const initial = {

      month: Array.from({length:10},()=>({checked:false,text:""})),

      week: Array.from({length:5},()=>({checked:false,text:""}))

    };

    days.forEach(d=>initial[d]=Array.from({length:10},()=>({checked:false,text:""})));

    let state = JSON.parse(localStorage.getItem(STORAGE_KEY)||JSON.stringify(initial));



    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function createItem(section,i){

      const it=state[section][i];

      const div=document.createElement('div');

      div.className='item'+(it.checked?' checked':'');

      const cb=document.createElement('input');cb.type='checkbox';cb.checked=it.checked;

      const input=document.createElement('input');input.type='text';input.className='text';input.value=it.text;

      cb.onchange=()=>{it.checked=cb.checked;div.classList.toggle('checked',cb.checked);save();};

      input.oninput=()=>{it.text=input.value;save();};

      div.append(cb,input);return div;

    }

    function render(){

      document.querySelectorAll('.list').forEach(list=>{

        const sec=list.dataset.section;

        list.innerHTML='';

        state[sec].forEach((_,i)=>list.append(createItem(sec,i)));

      });

      const wd=document.getElementById('weekdays');wd.innerHTML='';

      days.forEach(d=>{

        const card=document.createElement('div');card.className='weekday';

        const h=document.createElement('h3');h.textContent=d;card.append(h);

        state[d].forEach((_,i)=>card.append(createItem(d,i)));

        wd.append(card);

      });

    }

    document.getElementById('clearChecks').onclick=()=>{Object.keys(state).forEach(k=>state[k].forEach(i=>i.checked=false));save();render();};

    document.getElementById('resetAll').onclick=()=>{if(confirm('リセットしますか？')){state=JSON.parse(JSON.stringify(initial));save();render();}};

    document.getElementById('exportData').onclick=()=>{const b=new Blob([JSON.stringify(state)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='todo.json';a.click();};

    document.getElementById('importDataInput').onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=()=>{try{state=JSON.parse(r.result);save();render();}catch{alert('失敗');}};r.readAsText(f);}};

    render();

  </script>

</body>

</html>
